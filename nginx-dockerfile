# Use busybox como a imagem base
FROM busybox:latest

# Instalar wget e tcc (Tiny C Compiler)
RUN echo "Instalando wget e tcc..." && \
    mkdir -p /usr/local/bin && \
    wget -O /usr/local/bin/wget http://busybox.net/downloads/binaries/1.21.1/busybox-x86_64 && \
    chmod +x /usr/local/bin/wget && \
    wget -O /usr/local/bin/tcc http://download.savannah.gnu.org/releases/tinycc/tcc-0.9.27.tar.bz2 && \
    chmod +x /usr/local/bin/tcc && \
    echo "wget e tcc instalados com sucesso."

# Baixar e instalar o Nginx usando tcc
RUN echo "Baixando e instalando o Nginx..." && \
    wget http://nginx.org/download/nginx-1.21.6.tar.gz && \
    tar -xzvf nginx-1.21.6.tar.gz && \
    cd nginx-1.21.6 && \
    ./configure --without-http_rewrite_module --without-http_gzip_module CC=/usr/local/bin/tcc && \
    make CC=/usr/local/bin/tcc && \
    make install && \
    cd / && \
    rm -rf nginx-1.21.6* && \
    echo "Nginx instalado com sucesso."

# Criar diretório para logs do Nginx
RUN echo "Criando diretório para logs do Nginx..." && \
    mkdir -p /var/log/nginx && \
    echo "Diretório criado com sucesso."

# Copiar o arquivo de configuração do Nginx
COPY nginx.conf /etc/nginx/nginx.conf

# Expor a porta 80
EXPOSE 80

# Definir o entrypoint para executar o Nginx em primeiro plano
ENTRYPOINT ["nginx", "-g", "daemon off;"]
